var google_keys = {
 "81dda474db7e5c613f05d990445e4982826feb11": "-----BEGIN CERTIFICATE-----\nMIIDJjCCAg6gAwIBAgIIf6vK8a7S1cYwDQYJKoZIhvcNAQEFBQAwNjE0MDIGA1UE\nAxMrZmVkZXJhdGVkLXNpZ25vbi5zeXN0ZW0uZ3NlcnZpY2VhY2NvdW50LmNvbTAe\nFw0xNjAyMjcxNjI4MzRaFw0xNjAyMjkwNTI4MzRaMDYxNDAyBgNVBAMTK2ZlZGVy\nYXRlZC1zaWdub24uc3lzdGVtLmdzZXJ2aWNlYWNjb3VudC5jb20wggEiMA0GCSqG\nSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCiGDYQqo7wGzigu5/CjHA4yYL9fcxGx6XB\nPne4zIgfRxg6P+TJRLmEBdxWJbYMxnzoD2lKNyoQDDuZjRjKvcCMWzSqVi2L+vx9\n9z6KXmSWQQ3u50L5zTaHF0zdDxZJu8WYa9a6Fjpgm7gsMcQOma0mRVSfqHqzbLf+\nDa/wnShBJCU7o1q7eLXUXFMNWneYNOu1otGI699SPq0PtkmscT6btnQiqUol7BKU\nwgeUbWY+m5ZFpQcsDzCJH1A8Yyj895jqAApXS9E3+ybCunpLrE2bpeKE2/H/0FOW\n2hKkaRIgRWEPm+5fJgZpRv/TgQtRceajiucqVRaKiZlUh+47raoBAgMBAAGjODA2\nMAwGA1UdEwEB/wQCMAAwDgYDVR0PAQH/BAQDAgeAMBYGA1UdJQEB/wQMMAoGCCsG\nAQUFBwMCMA0GCSqGSIb3DQEBBQUAA4IBAQBsQEty5eyHy9Dpon9NIVaj1WIsrl0f\nNqekYP4yfa02cqg8AYcOU38SIFFSV6beOwh2ATrWK5jSbs4jawnYa85LwI7Djeh2\nQllXOGbwNjbCbUAqpRBWU5PUDFRBeBvhI7R/jnkr7IFe49WsD1JAcjKF/nNyH025\nDX1aldBDzlI+hs62IxGVyq4mikD3cru5w7AIfnmR5pP/9UgyFtIxwQ/Gn0r2kmMC\no/NIi81m/EaxWBXkcOvUkrLTGgpKUiNsm3F2YKh89DQ8Tcm8rIjs1gbAV8DJpuzr\nwgscuq1FZx7uxAncjp22dnxn1/Ym1STvDqpIqH35xg6FnSwhjFpDQBwV\n-----END CERTIFICATE-----\n",
 "2eaf87c041b8ea36773e859ab41477b960b8d524": "-----BEGIN CERTIFICATE-----\nMIIDJjCCAg6gAwIBAgIINwWkiWR2FuUwDQYJKoZIhvcNAQEFBQAwNjE0MDIGA1UE\nAxMrZmVkZXJhdGVkLXNpZ25vbi5zeXN0ZW0uZ3NlcnZpY2VhY2NvdW50LmNvbTAe\nFw0xNjAyMjgxNjEzMzRaFw0xNjAzMDEwNTEzMzRaMDYxNDAyBgNVBAMTK2ZlZGVy\nYXRlZC1zaWdub24uc3lzdGVtLmdzZXJ2aWNlYWNjb3VudC5jb20wggEiMA0GCSqG\nSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCktcZloHg0OQDABESadvgHgoLT+5thsXqh\n2RIFrAaU2EqQYKie1gPPtPWQ5T5pB0+BYpQUjXd0ajGC6V/HHNtTYK3CoMb+q5vv\n9IjIa8QoSl0vNf6KHde0MZyQuRwpGJRifECGapSRG1+66P0YpvVghnWCtjPLDfQC\n6uu+XQD2EN/K02E+3Ao37ogdp/j7migKTwKzS/hdkC0jAR9Cn34ErD7jdJcVIlB9\n3twTuwFIx2XLruR6dhogG7Icbx4RZJjQJg0/kbiAqxqlU2Qned+gm8rsUFsMvz+8\n6rFQgR3YDp8jj8cXc93QTgNNWrQhaNNiyvOl0bUZ6MraK9Wrv+vBAgMBAAGjODA2\nMAwGA1UdEwEB/wQCMAAwDgYDVR0PAQH/BAQDAgeAMBYGA1UdJQEB/wQMMAoGCCsG\nAQUFBwMCMA0GCSqGSIb3DQEBBQUAA4IBAQBIHy5fc1NpJE0RJfQP4xlmxcyAHXDf\nKL288MZTFKRqj1TH1kZFOTFrNVoBpzbugPmmaHfTBSRVSallOu8nxASJX2La6isN\nek1cevF3uqX5OaA0SbQ6/P79/ftEzXLvfi0X5G5iOQ9CuLWGGDQPhh/Ynpwc7d+V\nIFxsX2y7aGWXwKPw/VFv2ezpzvPxvMM5pT8jYT1N7EDcyUI+DvS7lJFfK01QUynE\n6cY9JDxw1+H/dy6/fNjpvlUjspEv/ykCWh4VzP27/3LkNMJlYoME1aPFRgy2W+u4\n7Gck4Pn7Cg85iUXOwp44TiL0ejoxG2kxaM9V+UTQr50hx7MFpX6TL51s\n-----END CERTIFICATE-----\n"
};

var client_id = '442029269791-mft6hqfi8ofrl246lae5eo7bg6olt9oq.apps.googleusercontent.com'

import * as jwt from 'jsonwebtoken'

export function verifyToken(token) {
    var gk = Object.keys(google_keys);
    for(var i=0; i<gk.length; ++i) {
        var key = google_keys[gk[i]];
        try {
            return jwt.verify(token, key, {
                algorithms: ['RS256'],
                audience: client_id,
                issuer: 'accounts.google.com'
            });
        } catch(e) {
            if(e.message !== 'invalid signature') {
                console.error(e);
            }
        }
    }
    return null;
}

export function verifyUser(authorization) {
    if(authorization && authorization.indexOf('Bearer ')==0) {
        var token = verifyToken(authorization.split(' ', 2)[1]);
        if(token && token['email'] === 'kenneth@wangpedersen.com') {
            return token;   
        } else {
            console.log("Invalid user: ");
            console.dir(token);
            return null;
        }
    }  
    return null;
}